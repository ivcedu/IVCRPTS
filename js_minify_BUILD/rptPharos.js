
var ct_month_data;var ct_device_data;var cf_month_data;var cf_device_data;var ct_pages=0;var ct_cost=0;var cf_pages=0;var ct_table;var cf_table;window.onload=function(){if(sessionStorage.key(0)!==null){getLoginInfo();isLoginAdmin();getDefaultStartEndDate();pharos_getIVCTotalPagesCost(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCTotalPagesCostDevice(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCTotalPagesCostRawData(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCFreeCharge(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCFreeChargeDevice(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCFreeChargeRawData(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));drawMorrisBarChartTotalPagesCost("chart_total_by_month",ct_month_data);drawMorrisBarChartFreeCharge("chart_free_by_month",cf_month_data)}else{window.open("login.html","_self")}};$(document).ready(function(){Spark.init();$("#nav_logout").click(function(){sessionStorage.clear();window.open("login.html","_self");return false});$('#ct_tabs a[data-toggle="tab"]').on("shown.bs.tab",function(b){var a=$(b.target).attr("href");if(a==="#chart_total_tab_month"&&$("#chart_total_by_month").html()===""){drawMorrisBarChartTotalPagesCost("chart_total_by_month",ct_month_data)}else{if(a==="#chart_total_tab_device"&&$("#chart_total_by_device").html()===""){drawMorrisBarChartTotalPagesCostDevice("chart_total_by_device",ct_device_data)}}return false});$('#cf_tabs a[data-toggle="tab"]').on("shown.bs.tab",function(b){var a=$(b.target).attr("href");if(a==="#chart_free_tab_month"&&$("#chart_free_by_month").html()===""){drawMorrisBarChartFreeCharge("chart_free_by_month",cf_month_data)}else{if(a==="#chart_free_tab_device"&&$("#chart_free_by_device").html()===""){drawMorrisBarChartFreeChargeDevice("chart_free_by_device",cf_device_data)}}return false});$("#btn_refresh").click(function(){pharos_getIVCTotalPagesCost(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCTotalPagesCostDevice(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCTotalPagesCostRawData(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCFreeCharge(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCFreeChargeDevice(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));pharos_getIVCFreeChargeRawData(convertSQLDateTimeFormat($("#start_date").datepicker("getDate"),"00:00:00.000"),convertSQLDateTimeFormat($("#end_date").datepicker("getDate"),"23:59:59.000"));if($("ul#ct_tabs li.active").attr("id")==="ct_tab_month"){drawMorrisBarChartTotalPagesCost("chart_total_by_month",ct_month_data)}else{if($("ul#ct_tabs li.active").attr("id")==="ct_tab_device"){drawMorrisBarChartTotalPagesCostDevice("chart_total_by_device",ct_device_data)}else{if($("ul#ct_tabs li.active").attr("id")==="ct_tab_raw_data"){}}}if($("ul#cf_tabs li.active").attr("id")==="cf_tab_month"){drawMorrisBarChartFreeCharge("chart_free_by_month",cf_month_data)}else{if($("ul#cf_tabs li.active").attr("id")==="cf_tab_device"){drawMorrisBarChartFreeChargeDevice("chart_free_by_device",cf_device_data)}else{if($("ul#cf_tabs li.active").attr("id")==="cf_tab_raw_data"){}}}this.blur();return false});ct_table=$("#tbl_ct_raw_data_list").DataTable({responsive:true,paging:false,bInfo:false,searching:false,order:[[3,"desc"]]});cf_table=$("#tbl_cf_raw_data_list").DataTable({responsive:true,paging:false,bInfo:false,searching:false,order:[[3,"desc"]]});$("#start_date").datepicker();$("#end_date").datepicker()});function getLoginInfo(){var a=sessionStorage.getItem("ss_rpts_loginName");$("#login_user").html(a+' <span class="caret"></span>');$("#pg_title").html("IVC Pharos");$("#pg_sub_title").html("IVC pharos students printer/copier dashboard")}function isLoginAdmin(){var a=new Array();a=db_getAdminByEmail(sessionStorage.getItem("ss_rpts_loginEmail"));if(a.length===1){$(".menu-system-setting").attr("style","display: block !important")}}function getDefaultStartEndDate(){$("#start_date").datepicker("setDate",getFistDayOfMothWithSetMonth(-6));$("#end_date").datepicker("setDate",getCurrentLastDayOfMonth())}function pharos_getIVCTotalPagesCost(b,d){var a=new Array();a=phar_getIVCTotalPagesCost(b,d);ct_month_data=[];ct_pages=0;ct_cost=0;for(var c=0;c<a.length;c++){ct_pages+=Number(a[c]["TotalPages"]);ct_cost+=Number(a[c]["TotalCost"]);ct_month_data.push({month:a[c]["RptMonth"]+" "+a[c]["RptYear"],tpages:Number(a[c]["TotalPages"]),tcost:Number(a[c]["TotalCost"])})}}function drawMorrisBarChartTotalPagesCost(a,b){$("#"+a).empty();$("#ct_month_pages").html("Total Pages: "+ct_pages);$("#ct_month_cost").html("Total Cost: "+formatDollar(ct_cost,2));Morris.Bar({element:a,data:b,xkey:"month",xLabelMargin:10,ykeys:["tpages","tcost"],labels:["Pages","Cost"],hideHover:"auto",resize:true,gridLineColor:"#eeeeee",barSizeRatio:0.7,barColors:["#006699","#993300"],redraw:true,hoverCallback:function(d,c,e,f){var f=c.data[d];month="<b>"+f.month+"</b>";tpages="<font color='#006699'>Pages: "+f.tpages+"</font>";tcost="<font color='#993300'>Cost: $"+f.tcost+"</font>";return[month,tpages,tcost].join("<br/>")}})}function pharos_getIVCTotalPagesCostDevice(b,h){var a=new Array();a=phar_getIVCTotalPagesCostDevice(b,h);ct_device_data=[];ct_pages=0;ct_cost=0;for(var e=0;e<a.length;e++){var g=a[e]["TotalCost"];var f=a[e]["TotalCost"].replace("$","");var d=Number(a[e]["TotalCost"].replace("$",""));var c=Number(f);ct_pages+=Number(a[e]["TotalPages"]);ct_cost+=Number(a[e]["TotalCost"]);ct_device_data.push({device:a[e]["Device"],tpages:Number(a[e]["TotalPages"]),tcost:Number(a[e]["TotalCost"])})}}function drawMorrisBarChartTotalPagesCostDevice(a,b){$("#"+a).empty();$("#ct_device_pages").html("Total Pages: "+ct_pages);$("#ct_device_cost").html("Total Cost: "+formatDollar(ct_cost,2));Morris.Bar({element:a,data:b,xkey:"device",xLabelMargin:10,ykeys:["tpages","tcost"],labels:["Pages","Cost"],hideHover:"auto",resize:true,gridLineColor:"#eeeeee",barSizeRatio:0.7,barColors:["#006699","#993300"],redraw:true,hoverCallback:function(d,c,e,f){var f=c.data[d];device="<b>"+f.device+"</b>";tpages="<font color='#006699'>Pages: "+f.tpages+"</font>";tcost="<font color='#993300'>Cost: $"+f.tcost+"</font>";return[device,tpages,tcost].join("<br/>")}})}function pharos_getIVCFreeCharge(b,d){var a=new Array();a=phar_getIVCFreeCharge(b,d);cf_month_data=[];cf_pages=0;for(var c=0;c<a.length;c++){cf_pages+=Number(a[c]["TotalPages"]);cf_month_data.push({month:a[c]["RptMonth"]+" "+a[c]["RptYear"],tpages:Number(a[c]["TotalPages"])})}}function drawMorrisBarChartFreeCharge(a,b){$("#"+a).empty();$("#cf_month_pages").html("Total Pages: "+cf_pages);Morris.Bar({element:a,data:b,xkey:"month",xLabelMargin:10,ykeys:["tpages"],labels:["Pages"],hideHover:"auto",resize:true,gridLineColor:"#eeeeee",barSizeRatio:0.4,barColors:["#009933"],redraw:true})}function pharos_getIVCFreeChargeDevice(b,d){var a=new Array();a=phar_getIVCFreeChargeDevice(b,d);cf_device_data=[];cf_pages=0;for(var c=0;c<a.length;c++){cf_pages+=Number(a[c]["TotalPages"]);cf_device_data.push({device:a[c]["Device"],tpages:Number(a[c]["TotalPages"])})}}function drawMorrisBarChartFreeChargeDevice(a,b){$("#"+a).empty();$("#cf_device_pages").html("Total Pages: "+cf_pages);Morris.Bar({element:a,data:b,xkey:"device",xLabelMargin:10,ykeys:["tpages"],labels:["Pages"],hideHover:"auto",resize:true,gridLineColor:"#eeeeee",barSizeRatio:0.4,barColors:["#009933"],redraw:true})}function pharos_getIVCTotalPagesCostRawData(b,c){var a=new Array();a=phar_getIVCTotalPagesCostRawData(b,c);ct_table.clear();ct_table.rows.add(a).draw()}function pharos_getIVCFreeChargeRawData(b,c){var a=new Array();a=phar_getIVCFreeChargeRawData(b,c);cf_table.clear();cf_table.rows.add(a).draw()};