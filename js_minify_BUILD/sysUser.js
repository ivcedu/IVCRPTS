
var m_table;var user_id="";window.onload=function(){if(sessionStorage.key(0)!==null){getLoginInfo();isLoginAdmin();getUserList()}else{window.open("login.html","_self")}};$(document).ready(function(){Spark.init();$("#nav_logout").click(function(){sessionStorage.clear();window.open("login.html","_self");return false});$("#btn_new_user").click(function(){user_id="";clearModalSection();$("#mod_user_header").html("New User Setting");$("#mod_user_active").iCheck("check");$("#mod_user_setting").modal("show");return false});$("#tbl_user_list").on("click",'a[id^="user_id_"]',function(){user_id=$(this).attr("id").replace("user_id_","");var a=new Array();a=db_getUserByID(user_id);clearModalSection();$("#mod_user_header").html("Edit Administrator Setting");if(a[0]["Active"]==="1"){$("#mod_user_active").iCheck("check")}else{$("#mod_user_active").iCheck("unchecke")}$("#mod_user_mame").val(a[0]["UserName"]);$("#mod_user_email").val(a[0]["UserEmail"]);$("#mod_user_setting").modal("show");return false});$("#mod_btn_user_save").click(function(){var d=($("#mod_user_active").is(":checked")?true:false);var c=$.trim($("#mod_user_mame").val());var a=$.trim($("#mod_user_email").val());if(user_id===""){if(!userValidation()){return false}else{if(db_insertUser(d,c,a)===""){$("#mod_user_setting").modal("hide");var b="DB system error INSERT USER";return dbSystemErrorHandling(b)}}}else{if(!db_updateUserByID(user_id,d,c,a)){$("#mod_user_setting").modal("hide");var b="DB system error UPDATE USER - UserID: "+user_id;return dbSystemErrorHandling(b)}}getUserList();$("#mod_user_setting").modal("hide");return false});m_table=$("#tbl_user_list").DataTable({paging:false,bInfo:false,searching:false,columnDefs:[{className:"dt-center",orderable:false,targets:3}]});$("input").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"})});function getLoginInfo(){var a=sessionStorage.getItem("ss_rpts_loginName");$("#login_user").html(a+' <span class="caret"></span>');$("#pg_title").html("Users");$("#pg_sub_title").html("User setting")}function userValidation(){if($.trim($("#mod_user_mame").val())===""){swal({title:"Error",text:"User name is a required field",type:"error"});return false}else{if($.trim($("#mod_user_email").val())===""){swal({title:"Error",text:"User email is a required field",type:"error"});return false}else{var a=new Array();a=db_getUserByEmail($.trim($("#mod_user_email").val()));if(a.length===1){swal({title:"Error",text:"User "+$("#mod_user_email").val()+" already exist",type:"error"});return false}else{return true}}}}function isLoginAdmin(){var a=new Array();a=db_getAdminByEmail(sessionStorage.getItem("ss_rpts_loginEmail"));if(a.length===1){$(".menu-system-setting").attr("style","display: block !important")}}function clearModalSection(){$("#mod_user_header").html("");$("#mod_user_active").iCheck("uncheck");$("#mod_user_mame").val("");$("#mod_user_email").val("")}function getUserList(){var a=new Array();a=db_getUserListDataTable();m_table.clear();m_table.rows.add(a).draw()};